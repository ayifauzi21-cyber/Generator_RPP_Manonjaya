<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generator RPP Deep Learning - SMPN 1 Manonjaya</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

    <!-- MATHJAX CONFIGURATION -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            ["$", "$"],
            ["\\(", "\\)"],
          ],
          displayMath: [
            ["$$", "$$"],
            ["\\[", "\\]"],
          ],
          processEscapes: true,
        },
      };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
        background-color: #f3f4f6;
      }
      .card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .input-group label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
      }
      .input-field {
        width: 100%;
        padding: 0.625rem;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 0.875rem;
        transition: all 0.2s;
        background-color: white;
      }
      .input-field:focus {
        outline: none;
        border-color: #1e3a8a;
        ring: 2px;
        ring-color: #bfdbfe;
      }
      .gradient-bg {
        background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
      }

      /* Typography & Table Styling for Output */
      #rppOutput {
        line-height: 1.6;
        color: #1a1a1a;
      }
      #rppOutput h2 {
        font-size: 1.25rem;
        font-weight: bold;
        margin: 24px 0 12px;
        border-bottom: 2px solid #1e3a8a;
        padding-bottom: 4px;
        display: inline-block;
      }
      #rppOutput h3 {
        font-size: 1.1rem;
        font-weight: 700;
        margin-top: 15px;
        color: #1e3a8a;
      }
      #rppOutput table {
        width: 100%;
        border-collapse: collapse;
        margin: 16px 0;
        background: white;
      }
      #rppOutput th,
      #rppOutput td {
        border: 1px solid #000;
        padding: 10px;
        text-align: left;
        vertical-align: top;
      }
      #rppOutput th {
        background-color: #f8fafc;
        font-weight: bold;
      }

      @media print {
        .no-print {
          display: none !important;
        }
        body {
          background: white;
          padding: 0;
        }
        .card {
          box-shadow: none;
          border: none;
        }
        #rppOutput {
          padding: 0;
        }
        #rppOutput table {
          page-break-inside: auto;
        }
        #rppOutput tr {
          page-break-inside: avoid;
          page-break-after: auto;
        }
      }
    </style>
  </head>
  <body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
      <!-- HEADER -->
      <header class="gradient-bg text-white p-6 rounded-t-xl flex justify-between items-center shadow-lg no-print">
        <div>
          <h1 class="text-2xl font-bold italic tracking-tight">Generator RPP Deep Learning + Visual Pro</h1>
          <p class="text-sm opacity-90 font-light">Edisi Rapih & Otomatis - SMPN 1 Manonjaya</p>
        </div>
        <button onclick="togglePanduan()" class="bg-white/20 hover:bg-white/30 px-5 py-2 rounded-lg text-sm font-semibold transition flex items-center"><i class="fas fa-info-circle mr-2"></i> PANDUAN</button>
      </header>

      <!-- FORM UTAMA -->
      <main id="mainForm" class="card p-8 rounded-b-xl space-y-8 no-print border-t-4 border-yellow-400">
        <!-- API KEY -->
        <div class="bg-blue-50 p-5 rounded-xl border border-blue-200">
          <div class="input-group">
            <label class="flex justify-between items-center text-blue-900 mb-2">
              <span><i class="fas fa-key mr-2"></i> Google Gemini API Key (Wajib)</span>
              <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs text-blue-700 underline italic">Dapatkan API Key Gratis</a>
            </label>
            <input type="password" id="apiKey" class="input-field" placeholder="Tempel API Key di sini..." />
          </div>
        </div>

        <!-- GRID FORM -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
          <!-- IDENTITAS -->
          <div class="space-y-5">
            <h3 class="font-bold text-lg text-gray-800 border-b pb-2 flex items-center uppercase tracking-wide"><i class="fas fa-id-card text-blue-800 mr-2"></i> Identitas</h3>
            <div class="input-group">
              <label>Nama Sekolah</label>
              <input type="text" id="namaSekolah" class="input-field" value="SMPN 1 Manonjaya" />
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div class="input-group">
                <label>Tahun Ajaran</label>
                <input type="text" id="tahunAjaran" class="input-field" value="2025/2026" readonly />
              </div>
              <div class="input-group">
                <label>Semester</label>
                <select id="semester" class="input-field">
                  <option value="Ganjil">Ganjil</option>
                  <option value="Genap" selected>Genap</option>
                </select>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div class="input-group">
                <label>Nama Guru</label>
                <input type="text" id="namaGuru" class="input-field" value="Ayi Fauzi, S.Pd." />
              </div>
              <div class="input-group">
                <label>NIP Guru</label>
                <input type="text" id="nipGuru" class="input-field" value="198011222009021004" />
              </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div class="input-group">
                <label>Kepala Sekolah</label>
                <input type="text" id="namaKepala" class="input-field" value="Asep Nurulloh, S.Pd., MM." />
              </div>
              <div class="input-group">
                <label>NIP Kepala Sekolah</label>
                <input type="text" id="nipKepala" class="input-field" value="197801122008011003" />
              </div>
            </div>
          </div>

          <!-- PEMBELAJARAN -->
          <div class="space-y-5">
            <h3 class="font-bold text-lg text-gray-800 border-b pb-2 flex items-center uppercase tracking-wide"><i class="fas fa-graduation-cap text-blue-800 mr-2"></i> Pembelajaran</h3>
            <div class="input-group">
              <label>Mata Pelajaran</label>
              <select id="mapel" class="input-field" onchange="updateCP()">
                <option value="">-- Pilih Mata Pelajaran --</option>
                <option value="Pendidikan Agama Islam dan Budi Pekerti">PAI & BP</option>
                <option value="Pendidikan Pancasila">Pendidikan Pancasila</option>
                <option value="Bahasa Indonesia">Bahasa Indonesia</option>
                <option value="Matematika">Matematika</option>
                <option value="Ilmu Pengetahuan Alam (IPA)">IPA</option>
                <option value="Ilmu Pengetahuan Sosial (IPS)">IPS</option>
                <option value="Bahasa Inggris">Bahasa Inggris</option>
                <option value="Pendidikan Jasmani Olahraga dan Kesehatan">PJOK</option>
                <option value="Informatika">Informatika</option>
                <option value="Seni dan Prakarya">Seni dan Prakarya</option>
                <option value="Bahasa Sunda">Bahasa Sunda</option>
              </select>
            </div>
            <div class="input-group">
              <label>Capaian Pembelajaran (Fase D Umum)</label>
              <textarea id="cp" rows="2" class="input-field text-[10px] italic bg-gray-50" readonly></textarea>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div class="input-group">
                <label>Kelas</label>
                <select id="kelas" class="input-field">
                  <option value="7">Kelas 7</option>
                  <option value="8" selected>Kelas 8</option>
                  <option value="9">Kelas 9</option>
                </select>
              </div>
              <div class="input-group">
                <label>Alokasi Waktu</label>
                <select id="alokasi" class="input-field">
                  <option value="2 JP (2 x 40 Menit)">2 JP</option>
                  <option value="3 JP (3 x 40 Menit)">3 JP</option>
                  <option value="4 JP (4 x 40 Menit)">4 JP</option>
                </select>
              </div>
            </div>
            <div class="input-group">
              <label>Materi Pokok</label>
              <input type="text" id="materi" class="input-field" placeholder="Contoh: Menulis Teks Deskriptif" />
            </div>
          </div>
        </div>

        <!-- TUJUAN PEMBELAJARAN (DILEBARKAN AGAR SIMETRIS) -->
        <div class="pt-4 border-t border-dashed border-gray-200">
          <div class="input-group">
            <label class="text-blue-900 font-bold"><i class="fas fa-bullseye mr-2"></i> Tujuan Pembelajaran (TP) Spesifik</label>
            <textarea id="tp" rows="3" class="input-field" placeholder="Tuliskan target kompetensi yang ingin dicapai siswa secara mendalam..."></textarea>
            <p class="text-[11px] text-gray-500 mt-1 italic">*Kolom ini dibuat melebar agar Anda dapat merinci tujuan pembelajaran dengan lebih leluasa.</p>
          </div>
        </div>

        <!-- BUTTON ACTION -->
        <div class="flex justify-center pt-2">
          <button id="btnGenerate" onclick="generateRPP()" class="w-full md:w-2/3 gradient-bg text-white font-bold py-4 rounded-xl shadow-lg hover:scale-[1.02] transition-transform flex justify-center items-center text-lg">
            <i class="fas fa-wand-magic-sparkles mr-3"></i> GENERATE RPP & LAMPIRAN RAPIH
          </button>
        </div>
      </main>

      <!-- RESULT AREA -->
      <div id="resultArea" class="hidden mt-8 space-y-6">
        <div class="flex justify-between items-center no-print bg-white p-4 rounded-xl shadow border">
          <span class="text-sm font-bold text-blue-800"><i class="fas fa-file-circle-check mr-2"></i> RPP BERHASIL DISUSUN</span>
          <div class="space-x-2">
            <button onclick="window.print()" class="bg-blue-700 text-white px-5 py-2 rounded-lg font-bold text-sm"><i class="fas fa-print mr-2"></i> CETAK PDF</button>
            <button onclick="resetApp()" class="bg-gray-200 text-gray-700 px-5 py-2 rounded-lg font-bold text-sm">EDIT DATA</button>
          </div>
        </div>

        <div id="rppOutput" class="bg-white p-12 border shadow-sm min-h-screen">
          <!-- Konten dari AI -->
        </div>
      </div>

      <!-- LOADER -->
      <div id="loader" class="hidden fixed inset-0 bg-white/90 z-50 flex flex-col items-center justify-center">
        <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-800 rounded-full animate-spin mb-4"></div>
        <p class="text-blue-900 font-bold animate-pulse text-lg">Menyusun Struktur RPP & Tabel Lampiran...</p>
      </div>
    </div>

    <script>
      const cpDatabase = {
        "Pendidikan Agama Islam dan Budi Pekerti": "Pada akhir Fase D, peserta didik mampu memahami ayat Al-Qur'an dan Hadis tentang pentingnya ilmu pengetahuan, beriman kepada kitab-kitab Allah, nabi dan rasul, serta hari akhir.",
        "Pendidikan Pancasila": "Pada akhir Fase D, peserta didik mampu menganalisis kronologi lahirnya Pancasila, fungsi dan kedudukan Pancasila sebagai dasar negara, pandangan hidup bangsa, serta ideologi negara.",
        "Bahasa Indonesia": "Pada akhir Fase D, peserta didik memiliki kemampuan berbahasa untuk berkomunikasi dan bernalar sesuai dengan tujuan, konteks sosial, dan akademis.",
        Matematika: "Pada akhir Fase D, peserta didik dapat menyelesaikan masalah kontekstual menggunakan konsep bilangan bulat, pecahan, rasio, aljabar, linearitas, geometri ruang dan datar.",
        "Ilmu Pengetahuan Alam (IPA)": "Pada akhir Fase D, peserta didik mampu melakukan klasifikasi makhluk hidup dan benda, memahami sistem organisasi kehidupan, serta menganalisis interaksi antar makhluk hidup dan lingkungan.",
        "Ilmu Pengetahuan Sosial (IPS)": "Pada akhir Fase D, peserta didik mampu menganalisis hubungan antara keruangan dan waktu, pengaruh interaksi sosial terhadap pembentukan lembaga sosial.",
        "Bahasa Inggris": "Pada akhir Fase D, peserta didik mampu menggunakan bahasa Inggris lisan, tulis, and multimodal dalam teks sederhana untuk berkomunikasi secara fungsional dalam konteks kehidupan sehari-hari.",
        "Pendidikan Jasmani Olahraga dan Kesehatan": "Pada akhir Fase D, peserta didik menunjukkan kemampuan dalam mempraktikkan berbagai keterampilan gerak spesifik permainan dan olahraga.",
        Informatika: "Pada akhir Fase D, peserta didik mampu memahami cara kerja perangkat keras, sistem operasi, serta jaringan komputer dan internet.",
        "Seni dan Prakarya": "Pada akhir Fase D, peserta didik mampu mengeksplorasi alat, teknik, dan prosedur dalam berkarya seni atau prakarya.",
        "Bahasa Sunda": "Dina akhir Fase D, murid mampuh komunikasi dina basa Sunda kalawan merenah tur luyu jeung tatakrama basa (undak-usuk basa).",
      };

      function updateCP() {
        const mapel = document.getElementById("mapel").value;
        document.getElementById("cp").value = cpDatabase[mapel] || "";
      }

      async function generateRPP() {
        const apiKey = document.getElementById("apiKey").value;
        if (!apiKey) {
          alert("Masukkan API Key!");
          return;
        }

        const data = {
          sekolah: document.getElementById("namaSekolah").value,
          guru: document.getElementById("namaGuru").value,
          nipGuru: document.getElementById("nipGuru").value,
          kepala: document.getElementById("namaKepala").value,
          nipKepala: document.getElementById("nipKepala").value,
          mapel: document.getElementById("mapel").value,
          materi: document.getElementById("materi").value,
          tp: document.getElementById("tp").value,
          kelas: document.getElementById("kelas").value,
          alokasi: document.getElementById("alokasi").value,
          cp: document.getElementById("cp").value,
          tahun: document.getElementById("tahunAjaran").value,
          semester: document.getElementById("semester").value,
        };

        if (!data.mapel || !data.materi || !data.tp) {
          alert("Mohon isi Mata Pelajaran, Materi, dan Tujuan Pembelajaran!");
          return;
        }

        document.getElementById("loader").classList.remove("hidden");

        const systemPrompt = `Anda adalah pakar Kurikulum Merdeka SMP. Buat Modul Ajar lengkap dengan Lampiran LKPD dan Rubrik Penilaian.
            KETENTUAN OUTPUT:
            1. Gunakan tabel HTML yang bersih (border="1") untuk Identitas, Langkah Pembelajaran, LKPD, dan Rubrik Penilaian.
            2. Bagian LKPD harus berisi tugas konkret yang menarik untuk siswa SMP.
            3. Bagian Rubrik harus memiliki kriteria dan skor (1-4) dalam bentuk tabel.
            4. Gunakan Bahasa Indonesia yang formal namun inspiratif (Deep Learning).
            5. Gunakan LaTeX $...$ untuk rumus jika ada.
            6. Jangan gunakan markdown berlebihan, fokus pada elemen tabel HTML.`;

        const userPrompt = `Buat Modul Ajar: 
            Sekolah: ${data.sekolah}, Guru: ${data.guru}, Mapel: ${data.mapel}, Materi: ${data.materi}, TP Spesifik: ${data.tp}, Kelas: ${data.kelas}, Alokasi: ${data.alokasi}, CP: ${data.cp}. 
            Pastikan lampiran LKPD dan Rubrik Penilaian dibuat sangat rapi dalam TABEL HTML.`;

        try {
          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [{ parts: [{ text: userPrompt }] }],
              systemInstruction: { parts: [{ text: systemPrompt }] },
            }),
          });

          const result = await response.json();
          let aiContent = result.candidates[0].content.parts[0].text;
          aiContent = aiContent.replace(/```html|```/g, "").trim();

          const header = `
                    <div style="text-align:center; border-bottom: 4px solid #000; padding-bottom:10px; margin-bottom:20px;">
                        <h1 style="font-size:1.5rem; font-weight:bold;">MODUL AJAR KURIKULUM MERDEKA</h1>
                        <h2 style="border:none; margin:0; font-size:1.2rem;">${data.sekolah.toUpperCase()}</h2>
                        <p>Tahun Pelajaran ${data.tahun} | Semester ${data.semester}</p>
                    </div>
                    <table style="width:100%; border:none; margin-bottom: 20px; font-size: 14px;">
                        <tr>
                            <td style="border:none; width:150px; padding:2px;">Mata Pelajaran</td><td style="border:none; width:10px; padding:2px;">:</td><td style="border:none; padding:2px;"><strong>${data.mapel}</strong></td>
                            <td style="border:none; width:150px; padding:2px;">Kelas / Fase</td><td style="border:none; width:10px; padding:2px;">:</td><td style="border:none; padding:2px;"><strong>${data.kelas} / D</strong></td>
                        </tr>
                        <tr>
                            <td style="border:none; padding:2px;">Materi Pokok</td><td style="border:none; padding:2px;">:</td><td style="border:none; padding:2px;"><strong>${data.materi}</strong></td>
                            <td style="border:none; padding:2px;">Alokasi Waktu</td><td style="border:none; padding:2px;">:</td><td style="border:none; padding:2px;"><strong>${data.alokasi}</strong></td>
                        </tr>
                    </table>
                `;

          const footer = `
                    <div style="margin-top: 50px; width: 100%; font-size: 13px; display: table;">
                        <div style="display: table-cell; width: 50%; text-align: center; vertical-align: top;">
                            <p>Mengetahui,</p>
                            <p>Kepala Sekolah</p>
                            <br><br><br><br>
                            <p><strong>${data.kepala}</strong></p>
                            <p>NIP. ${data.nipKepala}</p>
                        </div>
                        <div style="display: table-cell; width: 50%; text-align: center; vertical-align: top;">
                            <p>Manonjaya, ${new Date().toLocaleDateString("id-ID", { day: "numeric", month: "long", year: "numeric" })}</p>
                            <p>Guru Mata Pelajaran</p>
                            <br><br><br><br>
                            <p><strong>${data.guru}</strong></p>
                            <p>NIP. ${data.nipGuru}</p>
                        </div>
                    </div>
                `;

          document.getElementById("rppOutput").innerHTML = header + aiContent + footer;
          if (window.MathJax) window.MathJax.typesetPromise([document.getElementById("rppOutput")]);

          document.getElementById("mainForm").classList.add("hidden");
          document.getElementById("resultArea").classList.remove("hidden");
        } catch (e) {
          alert("Error: " + e.message);
        } finally {
          document.getElementById("loader").classList.add("hidden");
        }
      }

      function resetApp() {
        document.getElementById("resultArea").classList.add("hidden");
        document.getElementById("mainForm").classList.remove("hidden");
      }

      function togglePanduan() {
        alert("Panduan:\n1. Masukkan API Key.\n2. Pilih Mapel.\n3. Rinci Tujuan Pembelajaran di kolom lebar di bawah.\n4. Klik Generate.");
      }
    </script>
  </body>
</html>
